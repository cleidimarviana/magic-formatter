<html>
<head>
	<script src="assets/js/formatter.js"></script>
	<script src="assets/js/json2xml.js"></script>
	<script src="assets/js/xml2json.js"></script>
	<script src="assets/js/formatXML.js"></script>
	<link rel="stylesheet" type="text/css" href="assets/css/bulma.css">
	<link rel="stylesheet" type="text/css" href="assets/css/style.css">
	<script type="text/javascript">
		$(document).ready(function() {


			$('#jsonSubmit').bind('click', function() {
				var input = $('#input').val();
				//input.replace(/[\s\n]+/g, ' ')
				try {
					var c = $.parseJSON(input);
					$('#magicWarning').empty();
					var formattedJSONString = JSONFormat(input.replace(/[\s\n]+/g, ' '));

					$('#outputResult').removeClass('hidden');
					$('#output').html(formattedJSONString);

					var data = "data:text/json;charset=utf-8," + encodeURIComponent(formattedJSONString);
					$(".actions-pre").append('<a class="button" href="data:'+data+'" id="download" download="rabbit.json" data-tooltip="tooltip"  data-placement="bottom" title="Download JSON" innerHTML="download" class="export">Download</a>'); 

				}
				catch (err) {
					$('#outputResult').addClass('hidden');
					$('#output').empty();
				  // Do something about the exception here
				  $('#magicWarning').html("<div class='json-warning'>"+err+" | Expecting 'STRING', 'NUMBER', 'NULL', 'TRUE', 'FALSE', '{', '[', got 'undefined'. Something wrong is not right. The rabbit did not get out of the hat in time.</div>");
				}
			});


			$("#select-tab-space").on('change', function() {
				$("#output").attr('class', 'tabSpace'+this.value);
			});

			$("#select-convert").on('change', function() {

				if(this.value == 1){
					var input = $('#input').val();
					var formattedJSONString = JSONFormat(input.replace(/[\s\n]+/g, ' '));
					$('#output').html(formattedJSONString);
				}
				if(this.value == 2){
					$("#output").text(formatXml(json2xml($.parseJSON($('#input').val()),"")));
				}
			});

			$("#input-clear").on('click', function() {
				$("#input").val("");
			});


			$("#input-json2xml").on('click', function() {
			  	//$('#output').html(formattedJSONString);
			  	$("#output").text(formatXml(json2xml($.parseJSON($('#input').val()),"")));
			  });

			$("#btn-copyclipboard").on('click', function() {			  	
				clip(document.getElementById("output"));
			});


		});		

		var clip = function(el) {
			var range = document.createRange();
			range.selectNodeContents(el);
			var sel = window.getSelection();
			sel.removeAllRanges();
			sel.addRange(range);

			document.execCommand("copy");
			sel.removeAllRanges();
		};
	</script>
	
</head>
<body>
	<div class="section">
		<div class="content">
			<h3 id="header">MagicFormatter</h3>
			<textarea class="textarea" id="input" style="width:100%;" placeholder="Enter the content here..."></textarea>	

			<div class="actions">
				<div class="level-right" title="level-right">
					
					<button id="input-clear" class="button">
						Clear
					</button>

						<button class="button is-link" id="jsonSubmit">
							Make a magic 
						</button>
					
				</div>
			</div>

			<div style="position:fixed; bottom: 10px; right: 10px; float:right;" >
				<h3><a href="#header">Back to top</a></h3>
			</div>
			<div id="magicWarning"></div>

			<div class="hidden" id="outputResult" >
				<pre class="tabSpace2" id="output"></pre>

				<div class="actions-pre">
					<button class="button is-link output" id="btn-copyclipboard">
						Copy to clipboard 
					</button>
					<div class="select">
						<select id="select-convert">
							<option value="1">JSON to JSON</option>
							<option value="2">JSON to XML</option>
						</select>
					</div>

					<div class="select">
						<select id="select-tab-space">
							<option value="2">2 Tab Space</option>
							<option value="3">3 Tab Space</option>
							<option value="4">4 Tab Space</option>
						</select>
					</div>
				</div>
			</div>
		</div>
	</div>
</body>
</html>
